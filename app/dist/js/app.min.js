"use strict";angular.module("showFlex",["ngCookies","ngResource","ngSanitize","ui.router","ngMaterial","ngMdIcons","btford.socket-io"]).config(["$stateProvider","$urlRouterProvider","$mdThemingProvider",function(e,t,o){e.state("app",{url:"/app",templateUrl:"views/main.html",controller:"MainCtrl",abstract:!0}).state("app.home",{url:"/home",views:{mainView:{templateUrl:"views/home.html",controller:"homeCtrl"}}}).state("app.downloads",{url:"/downloads",views:{mainView:{templateUrl:"views/downloads.html",controller:"downCtrl"}}}).state("app.settings",{url:"/settings",views:{mainView:{templateUrl:"views/settings.html",controller:"settingsCtrl"}}}).state("app.queue",{url:"/queue",views:{mainView:{templateUrl:"views/queue.html",controller:"queueCtrl"}}}),t.otherwise("/app/home"),o.theme("default").primaryPalette("pink")}]).run(["$rootScope","socketEvt",function(e,t){e.$on("$stateChangeStart",function(e,o,r,l,n,i){"app.downloads"!==o.name&&t.emit("watchDownloads",!1)})}]).filter("iif",function(){return function(e,t,o){return e?t:o}});
"use strict";angular.module("showFlex").controller("downCtrl",["$scope","socketEvt","$rootScope","$http",function(n,o,t,a){n.files=[],n.loading=!0,n.changed=function(o){n.files=o},n.init=function(){a.get("api/downloads").then(function(o){n.loading=!1,n.files=o.data})},n.init(),o.add("downloadsChanged",n.changed),t.$on("$stateChangeStart",function(t,a,e,d,i,l){"app.downloads"!==a.name&&o.remove("downloadsChanged",n.changed)})}]);
"use strict";angular.module("showFlex").controller("homeCtrl",["$scope","$http","socketEvt","$mdDialog","$rootScope",function(e,t,n,o,a){e.files=[],e.loading=!0,e.getFiles=function(){t({method:"GET",url:"/medias?id="+Math.random(),headers:{"Cache-Control":"no-cache"}}).then(function(t){e.loading=!1,e.files=t.data})},e.removeFileByStreamUrl=function(t){_.each(e.files,function(n,o){n&&n.streamUrl===t&&e.files.splice(o,1)})},e.delete=function(n,o){e.removeFileByStreamUrl(n),t.delete(n).then(function(t){e.removeFileByStreamUrl(n)})},e.confirmDelete=function(t,n){var a=o.confirm().title("Confirm").textContent("Are you sure you wanna delete this episode?").ariaLabel("delete").targetEvent(n).ok("Yes").cancel("No");o.show(a).then(function(){e.delete(t,n)})},e.mediasChanged=function(t){e.files=t},e.getFiles(),n.add("mediasChanged",e.mediasChanged),a.$on("$stateChangeStart",function(t,o,a,i,l,r){"app.home"!==o.name&&n.remove("mediasChanged",e.mediasChanged)})}]);
"use strict";angular.module("showFlex").controller("MainCtrl",["$scope","$mdSidenav","socketEvt","$interval","$http","$mdDialog",function(e,o,t,r,s,a){function n(e,o){e.cancel=function(){o.cancel()},e.isUrl=function(e){var o=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return o.test(e)},e.sendReq=function(t){e.addQueueProgress=!0,s.post("/addToqueue",t).then(function(t){return e.addQueueProgress=!1,t.data.status?void o.cancel():void Materialize.toast(t.data.error,4e3,"red")})},e.add=function(){var o=e.addtoQueue;return isNaN(o.toepisode)&&"f"!==o.toepisode?void Materialize.toast("Sorry the to episode should be a number or 'f'",4e3,"red"):"f"!==o.toepisode&&parseInt(o.toepisode)<parseInt(o.fromepisode)?void Materialize.toast("The to episode should be greater or equals from episode",4e3,"red"):void e.sendReq({keyword:o.name,season:o.season,from:o.fromepisode,to:o.toepisode})},e.addUrl=function(){var o=e.manual;return isNaN(o.toepisode)&&"f"!==o.toepisode?void Materialize.toast("Sorry the to episode should be a number or 'f'",4e3,"red"):"f"!==o.toepisode&&parseInt(o.toepisode)<parseInt(o.fromepisode)?void Materialize.toast("The to episode should be greater or equals from episode",4e3,"red"):e.isUrl(o.url)?void e.sendReq({keyword:o.name,url:o.url,season:o.season,from:o.fromepisode,to:o.toepisode}):void Materialize.toast("The entred url is not a valid one",4e3,"red")}}e.serverOn=!1,e.addQueueProgress=!1,$(".button-collapse").sideNav(),t.add("log",function(e){Materialize.toast(e.str,4e3,"white"!==e.color?e.color:"")}),t.emit("serverStat"),r(function(){t.emit("serverStat")},7e3),t.add("serverStat",function(o){localStorage.queueCount||(localStorage.queueCount=o.queueCount),parseInt(localStorage.queueCount)<o.queueCount?e.newItems=o.queueCount-parseInt(localStorage.queueCount):e.newItems=!1,console.log(o),e.serverOn=o.running}),e.sendReq=function(e){return s({method:"GET",url:e})},e.startServer=function(){e.serverOn?e.sendReq("/stop").then(function(e){t.emit("serverStat")}):e.sendReq("/start").then(function(e){t.emit("serverStat")})},e.showAddtoQueue=function(e){a.show({controller:["$scope","$mdDialog",n],templateUrl:"views/addtoQueue.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})}}]);
angular.module("showFlex").controller("queueCtrl",["$scope","socketEvt","$rootScope","$http",function(e,t,n,u){e.queue=[],e.loading=!0,e.openMenu=function(e,t){e(t)},e.startFrom=function(n){var a=e.queue.filter(function(e){return e.done}),n=n-a.length;u({method:"GET",url:"/start",params:{index:n}}).then(function(e){e.data.error&&Materialize.toast(e.data.error,4e3,"red"),t.emit("serverStat")})},e.changed=function(t){e.queue=t},e.deleteFromQueue=function(t,n,a){e.queue.splice(a,1),u.post("/queue",{name:n.name,season:n.season,episode:n.episode}).then(function(e){e.data.status&&Materialize.toast("Item has been deleted successfly",4e3,"green")})},e.stateWatcher=function(t){e.queue[t.queueIndex]&&(e.queue[t.queueIndex].noOptions=t.running)},e.init=function(){u.get("/queue").then(function(t){e.loading=!1,e.queue=t.data})},e.init(),t.add("queueChanged",e.changed),t.add("serverStat",e.stateWatcher),n.$on("$stateChangeStart",function(n,u,a,o,r,i){"app.queue"!==u.name&&(t.remove("queueChanged",e.changed),t.remove("serverStat",e.stateWatcher))})}]);
angular.module("showFlex").controller("settingsCtrl",["$scope","socketEvt","$rootScope","$mdDialog",function(o,t,e,l){}]);
angular.module("showFlex").factory("serverSocket",["socketFactory",function(e){return e()}]);
angular.module("showFlex").factory("socketEvt",["serverSocket",function(n){function t(t,o){n.emit(t,o)}function o(n,t){i[n]?i[n].push(t):i[n]=[t]}function e(n,t){i[n]&&i[n].splice(i[n].indexOf(t),1)}function c(n,t){const o=i[n]?i[n]:[];o.forEach(function(n){n(t)})}var i={};return n.on("all",function(n){c(n.evt,n.data)}),{add:o,remove:e,emit:t,evts:i}}]);